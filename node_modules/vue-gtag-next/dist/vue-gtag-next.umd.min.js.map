{"version":3,"file":"vue-gtag-next.umd.min.js","sources":["../src/utils.js","../src/state.js","../src/api/query.js","../src/api/config.js","../src/api/custom-map.js","../src/api/disable.js","../src/api/event.js","../src/api/exception.js","../src/api/linker.js","../src/api/pageview.js","../src/api/purchase.js","../src/api/refund.js","../src/api/screenview.js","../src/api/set.js","../src/api/time.js","../src/bootstrap.js","../src/register-global-object.js","../src/router-state.js","../src/page-tracker.js","../src/index.js","../src/api/use-gtag.js"],"sourcesContent":["export const isBrowser = () => {\n  return typeof document !== \"undefined\" && typeof window !== \"undefined\";\n};\n\nexport const loadScript = (source, preconnect) => {\n  return new Promise((resolve, reject) => {\n    const head = document.head || document.getElementsByTagName(\"head\")[0];\n    const script = document.createElement(\"script\");\n\n    script.async = true;\n    script.src = source;\n    script.charset = \"utf-8\";\n\n    if (preconnect) {\n      const link = document.createElement(\"link\");\n\n      link.href = preconnect;\n      link.rel = \"preconnect\";\n\n      head.appendChild(link);\n    }\n\n    head.appendChild(script);\n\n    script.onload = resolve;\n    script.onerror = reject;\n  });\n};\n\nexport const merge = (obj = {}, newObj = {}) => {\n  Object.keys(newObj).forEach((key) => {\n    obj[key] = newObj[key];\n  });\n};\n","import { reactive, computed, toRefs } from \"vue\";\n\nconst state = reactive({\n  property: null,\n  isEnabled: true,\n  disableScriptLoader: false,\n  useDebugger: false,\n  globalObjectName: \"gtag\",\n  dataLayerName: \"dataLayer\",\n  resourceURL: \"https://www.googletagmanager.com/gtag/js\",\n  preconnectOrigin: \"https://www.googletagmanager.com\",\n  customResource: null,\n  appName: null,\n  appId: null,\n  appVersion: null,\n});\n\nexport const useState = () => toRefs(state);\n\nexport const defaultProperty = computed(() => {\n  const { property } = useState();\n\n  if (!property.value) {\n    return;\n  }\n\n  if (Array.isArray(property.value)) {\n    return property.value.find((p) => p.default === true) || property.value[0];\n  }\n\n  return property.value;\n});\n\nexport const hasId = computed(() => {\n  const { property } = useState();\n\n  return Boolean(property.value && property.value.id !== null);\n});\n\nexport const allProperties = computed(() => {\n  const { property } = useState();\n\n  if (Array.isArray(property.value)) {\n    return property.value;\n  }\n\n  return [property.value];\n});\n\nexport const isTracking = computed(() => {\n  const { isEnabled } = useState();\n  const property = defaultProperty.value;\n\n  return Boolean(property && property.id && isEnabled.value);\n});\n\nexport default state;\n","import { useState } from \"@/state\";\nimport { isBrowser } from \"@/utils\";\n\nexport default (...args) => {\n  if (!isBrowser()) {\n    return;\n  }\n\n  const { globalObjectName, useDebugger } = useState();\n\n  if (useDebugger.value) {\n    console.warn(\"[vue-gtag] Debugger:\", args);\n  }\n\n  window[globalObjectName.value](...args);\n};\n","import { allProperties } from \"@/state\";\nimport query from \"@/api/query\";\n\nexport default (...args) => {\n  allProperties.value.forEach((property) => {\n    query(\"config\", property.id, ...args);\n  });\n};\n","import config from \"@/api/config\";\n\nexport default (map) => {\n  config({\n    custom_map: map,\n  });\n};\n","import { isBrowser } from \"@/utils\";\nimport { allProperties } from \"@/state\";\n\nexport default (value = true) => {\n  if (!isBrowser()) {\n    return;\n  }\n\n  allProperties.value.forEach((property) => {\n    window[`ga-disable-${property.id}`] = value;\n  });\n};\n","import query from \"@/api/query\";\nimport { allProperties } from \"@/state\";\n\nexport default (eventName, eventParams = {}) => {\n  const params = { ...eventParams };\n\n  if (!params.send_to && allProperties.value.length > 1) {\n    params.send_to = allProperties.value.map((property) => property.id);\n  }\n\n  query(\"event\", eventName, params);\n};\n","import event from \"@/api/event\";\n\nexport default (...args) => {\n  event(\"exception\", ...args);\n};\n","import config from \"@/api/config\";\n\nexport default (...args) => {\n  config(\"linker\", ...args);\n};\n","import event from \"@/api/event\";\n\nexport default (value) => {\n  let params = {};\n\n  if (typeof value === \"string\") {\n    params = {\n      page_path: value,\n      page_location: window.location.href,\n    };\n  } else {\n    params = value;\n  }\n\n  if (typeof params.send_page_view === \"undefined\") {\n    params.send_page_view = true;\n  }\n\n  event(\"page_view\", params);\n};\n","import event from \"@/api/event\";\n\nexport default (...args) => {\n  event(\"purchase\", ...args);\n};\n","import event from \"@/api/event\";\n\nexport default (...args) => {\n  event(\"refund\", ...args);\n};\n","import { useState } from \"@/state\";\nimport event from \"@/api/event\";\n\nexport default (...args) => {\n  const { appName, appId, appVersion } = useState();\n  const [arg] = args;\n  let params = {};\n\n  if (typeof arg === \"string\") {\n    params = {\n      screen_name: arg,\n    };\n  } else {\n    params = arg;\n  }\n\n  if (params.app_name == null && appName.value != null) {\n    params.app_name = appName.value;\n  }\n\n  if (params.app_id == null && appId.value != null) {\n    params.app_id = appId.value;\n  }\n\n  if (params.app_version == null && appVersion.value != null) {\n    params.app_version = appVersion.value;\n  }\n\n  event(\"screen_view\", params);\n};\n","import query from \"@/api/query\";\n\nexport default (...args) => {\n  query(\"set\", ...args);\n};\n","import event from \"@/api/event\";\n\nexport default (...args) => {\n  event(\"timing_complete\", ...args);\n};\n","import { ref, watch } from \"vue\";\nimport { loadScript, isBrowser } from \"@/utils\";\nimport { query } from \"@/api\";\nimport {\n  isTracking,\n  hasId,\n  allProperties,\n  defaultProperty,\n  useState,\n} from \"@/state\";\n\nexport const isReady = ref(false);\n\nexport const isBootstrapped = ref(false);\n\nexport const bootstrap = () => {\n  const {\n    disableScriptLoader,\n    preconnectOrigin,\n    resourceURL,\n    dataLayerName,\n  } = useState();\n\n  if (!isBrowser() || !hasId.value || isBootstrapped.value) {\n    return;\n  }\n\n  isBootstrapped.value = true;\n\n  allProperties.value.forEach((property) => {\n    const params = Object.assign({ send_page_view: false }, property.params);\n    query(\"config\", property.id, params);\n  });\n\n  if (disableScriptLoader.value) {\n    isReady.value = true;\n    return;\n  }\n\n  const resource = `${resourceURL.value}?id=${defaultProperty.value.id}&l=${dataLayerName.value}`;\n\n  loadScript(resource, preconnectOrigin.value).then(() => {\n    isReady.value = true;\n  });\n};\n\nexport const useBootstrapWatcher = () => {\n  watch(\n    () => isTracking.value,\n    (val) => val && bootstrap(),\n    { immediate: true }\n  );\n};\n","import { isBrowser } from \"@/utils\";\nimport { useState } from \"@/state\";\n\nexport default () => {\n  if (!isBrowser()) {\n    return;\n  }\n\n  const { globalObjectName, dataLayerName } = useState();\n\n  if (window[globalObjectName.value] == null) {\n    window[dataLayerName.value] = window[dataLayerName.value] || [];\n    window[globalObjectName.value] = function () {\n      window[dataLayerName.value].push(arguments);\n    };\n  }\n\n  window[globalObjectName.value](\"js\", new Date());\n};\n","import { toRefs, reactive } from \"vue\";\n\nconst routerState = reactive({\n  template: null,\n  useScreenview: false,\n  skipSamePath: true,\n});\n\nexport const useRouterState = () => toRefs(routerState);\n\nexport default routerState;\n","import { watch, nextTick } from \"vue\";\nimport { merge } from \"@/utils\";\nimport { screenview, pageview } from \"@/api\";\nimport { isTracking } from \"@/state\";\nimport routerState, { useRouterState } from \"@/router-state\";\n\nexport const getTemplate = (to = {}, from = {}) => {\n  const { template, useScreenview } = useRouterState();\n  const customTemplate = template.value ? template.value(to, from) : null;\n\n  if (customTemplate) {\n    return customTemplate;\n  } else if (useScreenview.value) {\n    return {\n      screen_name: to.name,\n    };\n  } else {\n    return {\n      page_title: to.name,\n      page_path: to.path,\n      page_location: window.location.href,\n    };\n  }\n};\n\nexport const trackPage = (to = {}, from = {}) => {\n  const { useScreenview, skipSamePath } = useRouterState();\n\n  if (skipSamePath.value && to.path === from.path) {\n    return;\n  }\n\n  const params = getTemplate(to, from);\n\n  if (useScreenview.value) {\n    screenview(params);\n  } else {\n    pageview(params);\n  }\n};\n\nexport const trackRouter = (router, newState = {}) => {\n  merge(routerState, newState);\n\n  watch(\n    () => isTracking.value,\n    (val) => {\n      if (!val) {\n        return;\n      }\n\n      router.isReady().then(() => {\n        nextTick(() => {\n          trackPage(router.currentRoute.value);\n        });\n\n        router.afterEach((to, from) => {\n          nextTick(() => {\n            trackPage(to, from);\n          });\n        });\n      });\n    },\n    { immediate: true }\n  );\n};\n","import { useBootstrapWatcher } from \"@/bootstrap\";\nimport { merge } from \"@/utils\";\nimport state from \"@/state\";\nimport * as api from \"@/api\";\nimport registerGlobalObject from \"@/register-global-object\";\n\nexport default {\n  install: (app, newState = {}) => {\n    merge(state, newState);\n    registerGlobalObject();\n    useBootstrapWatcher();\n\n    app.config.globalProperties.$gtag = api;\n  },\n};\n\nexport { isReady } from \"@/bootstrap\";\nexport { isTracking, useState } from \"@/state\";\nexport { default as useGtag } from \"@/api/use-gtag\";\nexport { trackRouter } from \"@/page-tracker\";\nexport * from \"@/api\";\n","import * as api from \"@/api\";\n\nexport default () => api;\n"],"names":["isBrowser","document","window","merge","obj","newObj","Object","keys","forEach","key","state","reactive","property","isEnabled","disableScriptLoader","useDebugger","globalObjectName","dataLayerName","resourceURL","preconnectOrigin","customResource","appName","appId","appVersion","useState","toRefs","defaultProperty","computed","value","Array","isArray","find","p","hasId","Boolean","id","allProperties","isTracking","args","console","warn","query","map","config","custom_map","eventName","eventParams","params","send_to","length","event","page_path","page_location","location","href","send_page_view","arg","screen_name","app_name","app_id","app_version","isReady","ref","isBootstrapped","bootstrap","assign","source","preconnect","resource","Promise","resolve","reject","head","getElementsByTagName","script","createElement","async","src","charset","link","rel","appendChild","onload","onerror","then","useBootstrapWatcher","watch","val","immediate","push","arguments","Date","routerState","template","useScreenview","skipSamePath","useRouterState","getTemplate","to","from","customTemplate","name","page_title","path","trackPage","screenview","pageview","install","app","newState","registerGlobalObject","globalProperties","$gtag","api","router","nextTick","currentRoute","afterEach"],"mappings":"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"}